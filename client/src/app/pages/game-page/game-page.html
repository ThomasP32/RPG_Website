@if(!delayFinished) {
<div class="disable-interactions"></div>
<div class="turn-indicator">
    <h3>C'est au tour de {{currentPlayerTurn}} dans</h3>
    <span class="countdown-timer" [ngClass]="{ 'pulse': isPulsing }">{{startTurnCountdown}}</span>
</div>
} @if(youFell) {
<div class="disable-interactions"></div>
<div class="turn-indicator"><h3>Vous êtes tombé, votre tour est fini.</h3></div>
}
<div class="game-page-container">
    <div class="game-info-panel">
        <div class="game-info">
            <h2>Informations de la partie</h2>
            <p>Taille de la carte : {{ game.mapSize.x }} x {{ game.mapSize.y}}</p>
            <p>Nombre de joueurs : {{ activePlayers.length }}</p>
            <p>Joueur actif : {{ currentPlayerTurn }}</p>
        </div>

        <div class="player-info">
            <div class="player-info-header">
                <img [src]="playerPreview || 'assets/default-avatar.png'" alt="Avatar du joueur" class="player-avatar" />
                <h3>Informations de {{ player.name }}</h3>
            </div>

            <div class="stats">
                <div class="stat">
                    <label class="stat-label" data-title="Le nombre de points de vie du personnage."> Vie : {{ player.specs.life }} PV </label>
                    <div class="stat-bar">
                        <div class="stat-bar-fill" [style.width.%]="(player.specs.life / 10) * 100"></div>
                    </div>
                </div>
                <div class="stat">
                    <label class="stat-label" data-title="Correspond aux points de mouvement par tour d’un personnage."
                        >Rapidité : {{ player.specs.speed }} PTS</label
                    >
                    <div class="stat-bar">
                        <div class="stat-bar-fill" [style.width.%]="(player.specs.speed / 10) * 100"></div>
                    </div>
                </div>
                <div class="stat">
                    <label class="stat-label" data-title="Représente la force avec laquelle une attaque est faite sur l’adversaire."
                        >Attaque : {{player.specs.attack }} PTS</label
                    >
                    <div class="stat-bar">
                        <div class="stat-bar-fill" [style.width.%]="(player.specs.attack / 10) * 100"></div>
                    </div>
                </div>
                <div class="stat">
                    <label class="stat-label" data-title="Représente la capacité à bloquer l’attaque d’un adversaire."
                        >Défense : {{ player.specs.defense }} PTS</label
                    >
                    <div class="stat-bar">
                        <div class="stat-bar-fill" [style.width.%]="(player.specs.defense / 10) * 100"></div>
                    </div>
                </div>

                <p>Dé d'attaque = {{ player.specs.attackBonus }}</p>
                <p>Dé de défense = {{ player.specs.defenseBonus }}</p>
                <p>Mouvements restants : {{ player.specs.movePoints }}</p>
                <p>Actions restantes : {{ player.specs.actions }}</p>

            </div>

            <div class="inventory">
                <h3>Inventaire</h3>
                <div class="inventory-container">
                    <div class="inventory-slot" *ngFor="let slot of [1, 2]">
                        <div class="empty-slot">Vide</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="top-container">
        <div class="countdown-endturn-container">
            <div class="countdown-container">
                <h2>Temps restant</h2>
                <div class="countdown-timer" [ngClass]="{ 'pulse': isPulsing }">
                    <h3>{{ countdown }}</h3>
                </div>
                <h2>secondes</h2>
            </div>
            <button (click)="endTurn()">Fin du tour</button>
        </div>
    </div>

    <div class="game-map-container">
        <app-game-map [loadedMap]="game" [moves]="moves" [isYourTurn]="isYourTurn" (tileClicked)="onTileClickToMove($event)"> </app-game-map>
    </div>

    <div class="bottom-container">
        <button (click)="openExitConfirmationModal()">Quitter la partie</button>
    </div>

    <div class="right-panel">
        <div class="player-list">
            <app-game-players-list
                [players]="game.players"
                [hostSocketId]="game.hostSocketId"
                [currentPlayerTurn]="currentPlayerTurn"
            ></app-game-players-list>
        </div>
        @if(combatAvailable) {
        <app-combat-list [possibleOpponents]="possibleOpponents"></app-combat-list>
        }
        <div class="action-buttons">
            <button (click)="toggleDoor()">{{actionMessage}}</button>
        </div>

        <div class="toggle-container">
            <div class="toggle">
                <button [class.active]="activeView === 'chat'" (click)="toggleView('chat')">Clavardage</button>
                <button [class.active]="activeView === 'journal'" (click)="toggleView('journal')">Journal</button>
            </div>
        </div>

        <div class="chat-and-journal-container">
            <div class="game-page-chat" [class.hidden]="activeView !== 'chat'">
                <app-chatroom [player]="player" [gameId]="game.id"></app-chatroom>
            </div>

            <div class="journal" [class.hidden]="activeView !== 'journal'">
                <app-journal [player]="player"></app-journal>
            </div>
        </div>
    </div>
</div>

@if(showExitModal) {
<div class="open-exit-confirmation-modal">
    <div class="modal">
        <h2>Confirmer la sortie</h2>
        <p>Êtes-vous sûr de vouloir quitter la partie ?</p>
        <button class="modal-button" (click)="confirmExit()">Oui</button>
        <button class="modal-button" (click)="closeExitModal()">Non</button>
    </div>
</div>
} @if(showKickedModal) {
<div class="game-finished-modal">
    <div class="modal">
        <h2>Tous les joueurs ont abandonné.</h2>
        <p>La partie est finie, vous serez redirigé.</p>
    </div>
</div>
}@if(showEndGameModal) {
<div class="game-finished-modal">
    <div class="modal">
        <h2>Un joueur a gagné 3 combats.</h2>
        <p>La partie est finie, vous serez redirigé.</p>
    </div>
</div>
} @if(isCombatModalOpen){
<div>
    <app-combat-modal [player]="player" [opponent]="opponent"> </app-combat-modal>
    <!-- <app-combat-mock-modal></app-combat-mock-modal> -->
</div>

}
